<!DOCTYPE html>
<html>
<head>
  <title>Custom Image Receiver</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: black;
    }
    #image {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <img id="image" src="" alt="Image">

  <script src="//www.gstatic.com/cast/sdk/libs/receiver/3.0.0/cast_receiver_framework.js"></script>
  <script>
    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();

    const imageElement = document.getElementById('image');
    let currentImage = null;

    // Ảnh nền đầu tiên (thay thế bằng URL ảnh của bạn)
    const initialImageUrl = "https://fastly.picsum.photos/id/152/200/200.jpg?hmac=jxm74qVoEmDIDdKJ1_I2QT6AhtYcq-KN75l_iotKiOw";

    playerManager.setMessageInterceptor(
      cast.framework.messages.MessageType.LOAD,
      request => {
        if (request.media && request.media.contentId) {
          const imageUrl = request.media.contentId;
          loadImage(imageUrl);
          return null; // Ngăn chặn xử lý mặc định của LOAD
        }
        return request;
      }
    );

    function loadImage(imageUrl) {
      const img = new Image();
      img.onload = () => {
        imageElement.src = imageUrl;
        currentImage = imageUrl;
      };
      img.onerror = () => {
        console.error('Không thể tải ảnh:', imageUrl);
        // Xử lý lỗi tải ảnh (ví dụ: hiển thị ảnh mặc định)
      };
      img.src = imageUrl;
    }

    context.start();

    // Tải ảnh nền đầu tiên khi khởi động
    loadImage(initialImageUrl);
  </script>
</body>
</html>
